-
  vpc: e-commerce-demo
  region: eu-de
  classic_access: false
  resource_group: default
  default_network_acl: ecommerce-vpc-acl
  address_prefix:
    -
      name: ecommerce-vpc-zone-1
      zone: eu-de-1
      cidr: 172.16.0.0/18
    -
      name: ecommerce-vpc-zone-2
      zone: eu-de-2
      cidr: 172.16.64.0/18
    -
      name: ecommerce-vpc-zone-3
      zone: eu-de-3
      cidr: 172.16.128.0/18
  zones:
    -
      name: eu-de-1
      subnets:
        -
          name: web-tier-eu-de-1
          ipv4_cidr_block: 172.16.0.0/24
          network_acl: ecommerce-vpc-acl
          publicGateway: true
          instances:
            -
              name: web%02d-eu-de-1
              quantity: 1
              template: web_server
              floating_ip: true
              security_group: ecommerce-vpc-webtier
              in_lb_pool:
                -
                  lb_name: ecommerce-vpc-webtier-lb01
                  lb_pool: nginx-http
                  listen_port: 80
        -
          name: app-tier-eu-de-1
          ipv4_cidr_block: 172.16.16.0/24
          network_acl: ecommerce-vpc-acl
          publicGateway: true
          instances:
            -
              name: app%02d-eu-de-1
              quantity: 1
              template: app_server
              floating_ip: false
              security_group: ecommerce-vpc-apptier
              in_lb_pool:
                -
                  lb_name: ecommerce-vpc-apptier-lb01
                  lb_pool: index_php_upstream
                  listen_port: 8090
                -
                  lb_name: ecommerce-vpc-apptier-lb01
                  lb_pool: direct_php_upstream
                  listen_port: 8091
    -
      name: eu-de-2
      subnets:
        -
          name: web-tier-eu-de-2
          ipv4_cidr_block: 172.16.64.0/24
          publicGateway: true
          network_acl: ecommerce-vpc-acl
          instances:
            -
              name: web%02d-eu-de-2
              quantity: 1
              template: web_server
              floating_ip: true
              security_group: ecommerce-vpc-webtier
              in_lb_pool:
                -
                  lb_name: ecommerce-vpc-webtier-lb01
                  lb_pool: nginx-http
                  listen_port: 80
        -
          name: app-tier-eu-de-2
          ipv4_cidr_block: 172.16.80.0/24
          network_acl: ecommerce-vpc-acl
          publicGateway: true
          instances:
            -
              name: app%02d-eu-de-2
              quantity: 1
              template: app_server
              floating_ip: false
              security_group: ecommerce-vpc-apptier
              in_lb_pool:
                -
                  lb_name: ecommerce-vpc-apptier-lb01
                  lb_pool: index_php_upstream
                  listen_port: 8090
                -
                  lb_name: ecommerce-vpc-apptier-lb01
                  lb_pool: direct_php_upstream
                  listen_port: 8091

    -
      name: eu-de-3
      subnets:
        -
          name: web-tier-eu-de-3
          ipv4_cidr_block: 172.16.128.0/24
          network_acl: ecommerce-vpc-acl
          publicGateway: true
          instances:
            -
              name: web%02d-eu-de-3
              quantity: 1
              template: web_server
              floating_ip: true
              security_group: ecommerce-vpc-webtier
              in_lb_pool:
                -
                  lb_name: ecommerce-vpc-webtier-lb01
                  lb_pool: nginx-http
                  listen_port: 80
        -
          name: app-tier-eu-de-3
          ipv4_cidr_block: 172.16.144.0/24
          network_acl: ecommerce-vpc-acl
          publicGateway: true
          instances:
            -
              name: app%02d-eu-de-3
              quantity: 1
              template: app_server
              floating_ip: false
              security_group: ecommerce-vpc-apptier
              in_lb_pool:
                -
                  lb_name: ecommerce-vpc-apptier-lb01
                  lb_pool: index_php_upstream
                  listen_port: 8090
                -
                  lb_name: ecommerce-vpc-apptier-lb01
                  lb_pool: direct_php_upstream
                  listen_port: 8091

  load_balancers:
    -
      lbInstance: ecommerce-vpc-webtier-lb01
      is_public: true
      subnets:
        - web-tier-eu-de-1
        - web-tier-eu-de-2
      listeners:
        -
          protocol: http
          port: 80
          connection_limit: 100
          default_pool_name: nginx-http
      pools:
        -
          name: nginx-http
          protocol: http
          algorithm: round_robin
          health_monitor:
            type: http
            delay: 5
            max_retries: 2
            timeout: 2
            url_path: /nginx_status
    -
      lbInstance: ecommerce-vpc-apptier-lb01
      is_public: false
      subnets:
        - app-tier-eu-de-1
        - app-tier-eu-de-2
      listeners:
        -
          protocol: http
          port: 8090
          connection_limit: 100
          default_pool_name: index_php_upstream
        -
          protocol: http
          port: 8091
          connection_limit: 100
          default_pool_name: direct_php_upstream
      pools:
        - name: index_php_upstream
          protocol: http
          algorithm: least_connections
          health_monitor:
            type: http
            delay: 5
            max_retries: 2
            timeout: 2
            url_path: /
        - name: direct_php_upstream
          protocol: http
          algorithm: least_connections
          health_monitor:
            type: http
            delay: 5
            max_retries: 2
            timeout: 2
            url_path: /

  instanceTemplates:
    -
      template: web_server
      image_id: 7eb4e35b-4257-56f8-d7da-326d85452591
      profile_name: c-2x4
      sshkey_id: 636f6d70-0000-0001-0000-000000150ea7
      cloud-init-file: cloud-init-web.txt
    -
      template: app_server
      image_id: 7eb4e35b-4257-56f8-d7da-326d85452591
      profile_name: c-4x8
      sshkey_id: 636f6d70-0000-0001-0000-000000150ea7
      cloud-init-file: cloud-init-app.txt
    -
      template: db_server
      image_id: 7eb4e35b-4257-56f8-d7da-326d85452591
      profile_name: c-2x4
      sshkey_id: 636f6d70-0000-0001-0000-000000150ea7
      cloud-init-file: cloud-init.txt